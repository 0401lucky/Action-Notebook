# 实现计划

- [x] 1. 搭建认证基础设施





  - [x] 1.1 创建 AuthService 集成 Supabase Auth


    - 创建 `src/services/auth.ts`，实现 sendOTP、verifyOTP、getSession、signOut 方法
    - 实现错误消息映射为中文
    - 添加认证状态变化监听器
    - _需求: 1.1, 2.1, 4.1_
  - [x] 1.2 编写邮箱验证属性测试


    - **属性 1: 邮箱格式验证拒绝无效格式**
    - **验证需求: 1.2**


  - [ ] 1.3 编写错误消息本地化属性测试
    - **属性 6: 错误消息为中文**
    - **验证需求: 6.3**

- [x] 2. 创建 AuthStore 状态管理





  - [x] 2.1 使用 Pinia 实现 AuthStore


    - 创建 `src/stores/auth.ts`，包含 user、session、isLoading、error 状态
    - 实现 sendOTP、verifyOTP、signOut、initialize 操作
    - 添加 isAuthenticated 计算属性
    - _需求: 3.1, 3.4, 6.1, 6.2_
  - [x] 2.2 编写会话持久化属性测试


    - **属性 2: 会话持久化往返测试**
    - **验证需求: 3.1, 3.4**

  - [x] 2.3 编写登出清除会话属性测试
    - **属性 3: 登出清除所有会话数据**
    - **验证需求: 4.1, 4.2**

  - [x] 2.4 编写加载状态属性测试
    - **属性 5: 异步操作期间的加载状态**
    - **验证需求: 6.1, 6.2**

- [x] 3. 检查点 - 确保所有测试通过





  - 确保所有测试通过，如有问题请询问用户。

- [x] 4. 创建验证码输入组件





  - [x] 4.1 实现 VerificationCodeInput.vue


    - 创建 `src/components/auth/VerificationCodeInput.vue`
    - 渲染 6 个独立的数字输入框，使用玻璃拟态样式
    - 实现输入数字后自动聚焦下一格
    - 实现退格键导航到上一格
    - 实现粘贴 6 位验证码自动填充
    - 当所有数字填满时触发 complete 事件
    - _需求: 7.4, 8.1, 8.2, 8.3, 8.4_


  - [x] 4.2 编写自动聚焦下一格属性测试


    - **属性 7: 验证码自动聚焦下一格**


    - **验证需求: 8.1**


  - [x] 4.3 编写退格键聚焦属性测试





    - **属性 8: 验证码退格键聚焦上一格**
    - **验证需求: 8.2**
  - [x] 4.4 编写粘贴分发属性测试





    - **属性 9: 验证码粘贴分发**
  - [x] 4.5 编写自动提交属性测试









  - [ ] 4.5 编写自动提交属性测试

    - **属性 10: 验证码自动提交**
    - **验证需求: 8.4**
- [x] 5. 创建美观的登录页面




- [ ] 5. 创建美观的登录页面


  - [x] 5.1 实现 LoginView.vue

    - 创建 `src/views/LoginView.vue`
    - 设计居中卡片，使用玻璃拟态效果
    - 添加与 Indigo/Violet 主题一致的渐变背景
    - 实现邮箱输入步骤，带验证功能
    - 实现验证码输入步骤，使用 VerificationCodeInput 组件
    - 添加重新发送验证码的倒计时
    - 添加登录/注册模式之间的平滑过渡
    - 添加加载状态和成功/错误反馈
    - _需求: 7.1, 7.2, 7.3, 7.6, 8.5_
  - [x] 5.2 编写倒计时属性测试


    - **属性 11: 倒计时递减**
    - **验证需求: 8.5**

- [x] 6. 检查点 - 确保所有测试通过





  - 确保所有测试通过，如有问题请询问用户。

- [x] 7. 添加路由保护和导航





  - [x] 7.1 配置路由认证守卫


    - 在路由中添加 `/login` 路由
    - 创建导航守卫检查认证状态
    - 未认证用户重定向到登录页
    - 已认证用户从登录页重定向到首页
    - _需求: 5.3, 4.3_
  - [x] 7.2 更新 App.vue 初始化认证


    - 在应用挂载时调用 authStore.initialize()
    - 检查认证状态时显示加载状态
    - _需求: 3.1, 3.2, 3.3_

- [x] 8. 更新数据库层实现用户数据隔离





  - [x] 8.1 更新 DatabaseService 添加用户上下文


    - 修改 `src/services/database.ts`，在查询中包含 user_id
    - 更新 saveDailyRecord 附加 user_id
    - 更新 loadDailyRecord 按 user_id 过滤
    - 更新 loadArchivedRecords 按 user_id 过滤
    - _需求: 5.1, 5.2_
  - [x] 8.2 编写用户数据隔离属性测试


    - **属性 4: 用户数据隔离**
    - **验证需求: 5.1, 5.2**

- [x] 9. 添加登出功能到界面






  - [x] 9.1 更新 AppHeader 添加登出按钮

    - 在 `src/components/common/AppHeader.vue` 添加登出按钮
    - 登录后显示用户邮箱
    - 点击时调用 authStore.signOut()
    - _需求: 4.1, 4.2, 4.3_

- [x] 10. 更新类型定义





  - [x] 10.1 在 types/index.ts 添加认证类型


    - 添加 AuthUser 接口
    - 添加 Session 接口
    - 添加 AuthError 接口
    - 添加 AuthResult 类型
    - _需求: 全部_

- [x] 11. 最终检查点 - 确保所有测试通过





  - 确保所有测试通过，如有问题请询问用户。

