# Design Document

## Overview

æœ¬è®¾è®¡æ–‡æ¡£æè¿°æ—¥è®°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„æŠ€æœ¯å®ç°æ–¹æ¡ˆã€‚ä½¿ç”¨ Tiptap ç¼–è¾‘å™¨æ¡†æ¶æ›¿æ¢ç°æœ‰çš„ `<textarea>`ï¼Œæä¾›åŠ ç²—ã€æ–œä½“ã€åˆ é™¤çº¿ã€åˆ—è¡¨ã€å¼•ç”¨å—å’Œä»£ç å—ç­‰æ ¼å¼åŒ–åŠŸèƒ½ã€‚

### æŠ€æœ¯é€‰å‹

- **Tiptap**: åŸºäº ProseMirror çš„ Vue 3 å‹å¥½å‹å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- **@tiptap/vue-3**: Vue 3 é›†æˆåŒ…
- **@tiptap/starter-kit**: åŸºç¡€æ‰©å±•åŒ…ï¼ˆåŒ…å«å¸¸ç”¨æ ¼å¼åŒ–åŠŸèƒ½ï¼‰
- **@tiptap/extension-placeholder**: å ä½ç¬¦æ‰©å±•

### è®¾è®¡åŸåˆ™

1. **æœ€å°ä¾µå…¥**: ä»…ä¿®æ”¹ç¼–è¾‘å™¨ç»„ä»¶ï¼Œä¿æŒç°æœ‰æ•°æ®æµä¸å˜
2. **å‘åå…¼å®¹**: æ”¯æŒæ˜¾ç¤ºæ—§çš„çº¯æ–‡æœ¬å†…å®¹
3. **æ¸è¿›å¢å¼º**: å·¥å…·æ æŒ‰éœ€æ˜¾ç¤ºï¼Œä¸å½±å“ç®€å•è¾“å…¥åœºæ™¯

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    JournalEditor.vue                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  RichTextEditor.vue                  â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚              EditorToolbar.vue                  â”‚â”‚â”‚
â”‚  â”‚  â”‚  [B] [I] [S] [UL] [OL] [Quote] [Code]          â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚              EditorContent                      â”‚â”‚â”‚
â”‚  â”‚  â”‚         (Tiptap ç¼–è¾‘åŒºåŸŸ)                       â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                   MoodPicker.vue                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## UI Design

### å·¥å…·æ è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”          â”‚
â”‚  â”‚ B â”‚ â”‚ I â”‚ â”‚ S â”‚  â”‚  â”‚ â€¢ â”‚ â”‚ 1.â”‚  â”‚  â”‚ " â”‚ â”‚</>â”‚          â”‚
â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚    æ–‡æœ¬æ ¼å¼          â”‚    åˆ—è¡¨       â”‚   åŒºå—                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥å…·æ æŒ‰é’®

| æŒ‰é’® | å›¾æ ‡ | åŠŸèƒ½ | å¿«æ·é”® |
|------|------|------|--------|
| åŠ ç²— | **B** | åˆ‡æ¢åŠ ç²— | Ctrl+B |
| æ–œä½“ | *I* | åˆ‡æ¢æ–œä½“ | Ctrl+I |
| åˆ é™¤çº¿ | ~~S~~ | åˆ‡æ¢åˆ é™¤çº¿ | Ctrl+Shift+S |
| æ— åºåˆ—è¡¨ | â€¢ | åˆ‡æ¢æ— åºåˆ—è¡¨ | Ctrl+Shift+8 |
| æœ‰åºåˆ—è¡¨ | 1. | åˆ‡æ¢æœ‰åºåˆ—è¡¨ | Ctrl+Shift+7 |
| å¼•ç”¨å— | " | åˆ‡æ¢å¼•ç”¨å— | Ctrl+Shift+B |
| ä»£ç å— | </> | åˆ‡æ¢ä»£ç å— | Ctrl+Alt+C |

### æŒ‰é’®çŠ¶æ€æ ·å¼

```scss
// é»˜è®¤çŠ¶æ€
.toolbar-btn {
  width: 32px;
  height: 32px;
  border-radius: var(--radius-md);
  background: transparent;
  color: var(--text-secondary);
  transition: all 0.2s;
  
  &:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
  }
}

// æ¿€æ´»çŠ¶æ€
.toolbar-btn--active {
  background: var(--color-primary-fade);
  color: var(--color-primary);
}
```

### ç¼–è¾‘åŒºåŸŸæ ·å¼

```scss
.editor-content {
  min-height: 120px;
  padding: var(--spacing-md);
  
  // å¼•ç”¨å—æ ·å¼
  blockquote {
    border-left: 3px solid var(--color-primary);
    background: var(--color-primary-fade);
    padding: var(--spacing-sm) var(--spacing-md);
    margin: var(--spacing-sm) 0;
    border-radius: 0 var(--radius-md) var(--radius-md) 0;
    font-style: italic;
    color: var(--text-secondary);
  }
  
  // ä»£ç å—æ ·å¼
  pre {
    background: var(--bg-tertiary);
    padding: var(--spacing-md);
    border-radius: var(--radius-md);
    font-family: 'Fira Code', monospace;
    font-size: var(--font-size-sm);
    overflow-x: auto;
  }
  
  // åˆ—è¡¨æ ·å¼
  ul, ol {
    padding-left: var(--spacing-xl);
    margin: var(--spacing-sm) 0;
  }
}
```

### å“åº”å¼è®¾è®¡

```scss
// ç§»åŠ¨ç«¯å·¥å…·æ 
@media (max-width: 480px) {
  .editor-toolbar {
    flex-wrap: wrap;
    gap: var(--spacing-xs);
    
    .toolbar-btn {
      width: 36px;
      height: 36px;
    }
    
    .toolbar-divider {
      display: none;
    }
  }
}
```

### æ•´ä½“å¸ƒå±€ç¤ºæ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœï¸ ä»Šæ—¥å¤ç›˜                                    [2 æ¡è®°å½•]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [B] [I] [S] â”‚ [â€¢] [1.] â”‚ ["] [</>]                      â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚  è®°å½•æ­¤åˆ»çš„æƒ³æ³•ã€æ„Ÿå—æˆ–äº‹ä»¶...                           â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ˜Š ğŸ˜ ğŸ˜¢ ğŸ¤© ğŸ˜´                        [â• æ·»åŠ æ—¥è®°]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ æç¤ºï¼šCtrl+Enter å¿«é€Ÿæ·»åŠ                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥ â†’ Tiptap Editor â†’ HTML å­—ç¬¦ä¸² â†’ JournalEntry.content â†’ æ•°æ®åº“
```

## Components and Interfaces

### RichTextEditor ç»„ä»¶

```typescript
// src/components/journal/RichTextEditor.vue

interface Props {
  modelValue: string          // HTML å†…å®¹ (v-model)
  placeholder?: string        // å ä½ç¬¦æ–‡æœ¬
  readonly?: boolean          // åªè¯»æ¨¡å¼
  autofocus?: boolean         // è‡ªåŠ¨èšç„¦
}

interface Emits {
  (e: 'update:modelValue', value: string): void
  (e: 'submit'): void         // Ctrl+Enter æäº¤
}
```

### EditorToolbar ç»„ä»¶

```typescript
// src/components/journal/EditorToolbar.vue

interface Props {
  editor: Editor | null       // Tiptap Editor å®ä¾‹
}

interface ToolbarButton {
  name: string                // æŒ‰é’®åç§°
  icon: string                // å›¾æ ‡ï¼ˆemoji æˆ– SVGï¼‰
  action: () => void          // ç‚¹å‡»åŠ¨ä½œ
  isActive: () => boolean     // æ˜¯å¦æ¿€æ´»çŠ¶æ€
  shortcut?: string           // å¿«æ·é”®æç¤º
}
```

### useRichTextEditor Composable

```typescript
// src/composables/useRichTextEditor.ts

interface UseRichTextEditorOptions {
  content?: string
  placeholder?: string
  editable?: boolean
  onUpdate?: (html: string) => void
  onSubmit?: () => void
}

interface UseRichTextEditorReturn {
  editor: Ref<Editor | null>
  isEmpty: ComputedRef<boolean>
  getHTML: () => string
  setContent: (html: string) => void
  focus: () => void
  clear: () => void
}
```

## Data Models

### JournalEntry ç±»å‹æ›´æ–°

ç°æœ‰çš„ `JournalEntry.content` å­—æ®µå°†å­˜å‚¨ HTML å­—ç¬¦ä¸²è€Œéçº¯æ–‡æœ¬ã€‚æ— éœ€ä¿®æ”¹ç±»å‹å®šä¹‰ï¼Œä½†éœ€è¦æ³¨æ„ï¼š

```typescript
// ç°æœ‰ç±»å‹ä¿æŒä¸å˜
interface JournalEntry {
  id: string
  content: string               // ç°åœ¨å­˜å‚¨ HTML å­—ç¬¦ä¸²
  mood: MoodType | null
  createdAt: string
}
```

### HTML å†…å®¹æ ¼å¼

ç¼–è¾‘å™¨è¾“å‡ºçš„ HTML ç»“æ„ç¤ºä¾‹ï¼š

```html
<!-- åŠ ç²—ã€æ–œä½“ã€åˆ é™¤çº¿ -->
<p>è¿™æ˜¯<strong>åŠ ç²—</strong>å’Œ<em>æ–œä½“</em>ä»¥åŠ<s>åˆ é™¤çº¿</s>æ–‡æœ¬</p>

<!-- æ— åºåˆ—è¡¨ -->
<ul>
  <li>åˆ—è¡¨é¡¹ 1</li>
  <li>åˆ—è¡¨é¡¹ 2</li>
</ul>

<!-- æœ‰åºåˆ—è¡¨ -->
<ol>
  <li>æ­¥éª¤ 1</li>
  <li>æ­¥éª¤ 2</li>
</ol>

<!-- å¼•ç”¨å— -->
<blockquote>è¿™æ˜¯ä¸€æ®µå¼•ç”¨æ–‡å­—</blockquote>

<!-- ä»£ç å— -->
<pre><code>const hello = 'world';</code></pre>
```

## Correctness Properties

*A property is a characteristic or behavior that should hold true across all valid executions of a system-essentially, a formal statement about what the system should do. Properties serve as the bridge between human-readable specifications and machine-verifiable correctness guarantees.*

åŸºäºéœ€æ±‚åˆ†æï¼Œä»¥ä¸‹æ˜¯éœ€è¦éªŒè¯çš„æ­£ç¡®æ€§å±æ€§ï¼š

### Property 1: æ–‡æœ¬æ ¼å¼åŒ–åº”ç”¨æ­£ç¡®æ€§

*For any* æ–‡æœ¬å†…å®¹å’Œæ ¼å¼åŒ–ç±»å‹ï¼ˆåŠ ç²—/æ–œä½“/åˆ é™¤çº¿ï¼‰ï¼Œå½“å¯¹é€‰ä¸­æ–‡æœ¬åº”ç”¨è¯¥æ ¼å¼åŒ–æ—¶ï¼Œè¾“å‡ºçš„ HTML åº”åŒ…å«å¯¹åº”çš„æ ‡ç­¾ï¼ˆ`<strong>`/`<em>`/`<s>`ï¼‰åŒ…è£¹è¯¥æ–‡æœ¬ã€‚

**Validates: Requirements 1.1, 1.2, 1.3**

### Property 2: åˆ—è¡¨æ ¼å¼åŒ–æ­£ç¡®æ€§

*For any* æ–‡æœ¬å†…å®¹å’Œåˆ—è¡¨ç±»å‹ï¼ˆæœ‰åº/æ— åºï¼‰ï¼Œå½“åº”ç”¨åˆ—è¡¨æ ¼å¼åŒ–æ—¶ï¼Œè¾“å‡ºçš„ HTML åº”åŒ…å«å¯¹åº”çš„åˆ—è¡¨æ ‡ç­¾ï¼ˆ`<ul><li>`/`<ol><li>`ï¼‰ã€‚

**Validates: Requirements 2.1, 2.2**

### Property 3: å¼•ç”¨å—åˆ‡æ¢å¹‚ç­‰æ€§

*For any* æ®µè½å†…å®¹ï¼Œå¯¹å…¶åº”ç”¨å¼•ç”¨å—æ ¼å¼åŒ–ä¸¤æ¬¡åº”è¿”å›åŸå§‹çŠ¶æ€ï¼ˆæ— å¼•ç”¨å—ï¼‰ã€‚

**Validates: Requirements 3.1, 3.2**

### Property 4: ä»£ç å—ç©ºç™½ä¿ç•™

*For any* åŒ…å«ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œï¼‰çš„æ–‡æœ¬ï¼Œåœ¨ä»£ç å—ä¸­è¾“å…¥åï¼Œè¾“å‡ºçš„ HTML åº”ç²¾ç¡®ä¿ç•™è¿™äº›ç©ºç™½å­—ç¬¦ã€‚

**Validates: Requirements 4.3**

### Property 5: å·¥å…·æ çŠ¶æ€ä¸å…‰æ ‡ä½ç½®ä¸€è‡´æ€§

*For any* æ ¼å¼åŒ–ç±»å‹ï¼Œå½“å…‰æ ‡ä½äºè¯¥æ ¼å¼åŒ–å†…éƒ¨æ—¶ï¼Œå¯¹åº”çš„å·¥å…·æ æŒ‰é’®åº”æ˜¾ç¤ºä¸ºæ¿€æ´»çŠ¶æ€ã€‚

**Validates: Requirements 5.1, 5.2, 5.3, 5.4, 5.5**

### Property 6: HTML åºåˆ—åŒ–å¾€è¿”ä¸€è‡´æ€§

*For any* æœ‰æ•ˆçš„ç¼–è¾‘å™¨å†…å®¹ï¼Œå°†å…¶åºåˆ—åŒ–ä¸º HTML åå†ååºåˆ—åŒ–å›ç¼–è¾‘å™¨ï¼Œåº”äº§ç”Ÿç­‰ä»·çš„å†…å®¹ç»“æ„ã€‚

**Validates: Requirements 6.4**

### Property 7: åªè¯»æ¨¡å¼ä¸å¯ç¼–è¾‘

*For any* å¤„äºåªè¯»æ¨¡å¼çš„ç¼–è¾‘å™¨å®ä¾‹ï¼Œå…¶ `editable` å±æ€§åº”ä¸º `false`ï¼Œä¸”å·¥å…·æ åº”ä¸å¯è§ã€‚

**Validates: Requirements 7.1**

### Property 8: ç©ºå†…å®¹æ˜¾ç¤ºå ä½ç¬¦

*For any* å†…å®¹ä¸ºç©ºçš„ç¼–è¾‘å™¨å®ä¾‹ï¼Œåº”æ˜¾ç¤ºé…ç½®çš„å ä½ç¬¦æ–‡æœ¬ã€‚

**Validates: Requirements 7.4**

## Error Handling

### å†…å®¹éªŒè¯

```typescript
/**
 * éªŒè¯ HTML å†…å®¹æ˜¯å¦æœ‰æ•ˆï¼ˆéç©ºç™½ï¼‰
 * éœ€è¦å¤„ç† HTML æ ‡ç­¾ï¼Œåªæ£€æŸ¥å®é™…æ–‡æœ¬å†…å®¹
 */
function validateRichContent(html: string): boolean {
  // ç§»é™¤ HTML æ ‡ç­¾åæ£€æŸ¥æ˜¯å¦æœ‰å®é™…å†…å®¹
  const textContent = html.replace(/<[^>]*>/g, '').trim()
  return textContent.length > 0
}
```

### å‘åå…¼å®¹

```typescript
/**
 * æ£€æµ‹å†…å®¹æ˜¯å¦ä¸ºçº¯æ–‡æœ¬ï¼ˆæ—§æ•°æ®ï¼‰
 * å¦‚æœæ˜¯çº¯æ–‡æœ¬ï¼ŒåŒ…è£…ä¸ºæ®µè½æ ‡ç­¾
 */
function normalizeContent(content: string): string {
  if (!content) return ''
  // å¦‚æœä¸åŒ…å« HTML æ ‡ç­¾ï¼Œè§†ä¸ºçº¯æ–‡æœ¬
  if (!/<[^>]+>/.test(content)) {
    return `<p>${content}</p>`
  }
  return content
}
```

### XSS é˜²æŠ¤

Tiptap é»˜è®¤ä¼šå¯¹è¾“å…¥è¿›è¡Œæ¸…ç†ï¼Œåªå…è®¸é…ç½®çš„æ ‡ç­¾å’Œå±æ€§ã€‚é¢å¤–çš„å®‰å…¨æªæ–½ï¼š

- ä¸å…è®¸ `<script>` æ ‡ç­¾
- ä¸å…è®¸ `onclick` ç­‰äº‹ä»¶å±æ€§
- ä¸å…è®¸ `javascript:` åè®®é“¾æ¥

## Testing Strategy

### æµ‹è¯•æ¡†æ¶

- **å•å…ƒæµ‹è¯•**: Vitest
- **å±æ€§æµ‹è¯•**: fast-checkï¼ˆç”¨äºå±æ€§åŸºæµ‹è¯•ï¼‰
- **ç»„ä»¶æµ‹è¯•**: @vue/test-utils

### å•å…ƒæµ‹è¯•è¦†ç›–

1. `validateRichContent` å‡½æ•° - éªŒè¯å„ç§ HTML è¾“å…¥
2. `normalizeContent` å‡½æ•° - éªŒè¯çº¯æ–‡æœ¬è½¬æ¢
3. `useRichTextEditor` composable - éªŒè¯ç¼–è¾‘å™¨çŠ¶æ€ç®¡ç†

### å±æ€§åŸºæµ‹è¯•

ä½¿ç”¨ fast-check åº“è¿›è¡Œå±æ€§åŸºæµ‹è¯•ï¼ŒéªŒè¯ä»¥ä¸‹å±æ€§ï¼š

1. **Property 1**: æ ¼å¼åŒ–åº”ç”¨æ­£ç¡®æ€§
2. **Property 3**: å¼•ç”¨å—åˆ‡æ¢å¹‚ç­‰æ€§
3. **Property 6**: HTML åºåˆ—åŒ–å¾€è¿”ä¸€è‡´æ€§

æ¯ä¸ªå±æ€§æµ‹è¯•è¿è¡Œè‡³å°‘ 100 æ¬¡è¿­ä»£ã€‚

### æµ‹è¯•æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ components/journal/
â”‚   â”œâ”€â”€ RichTextEditor.vue
â”‚   â”œâ”€â”€ RichTextEditor.test.ts      # ç»„ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ EditorToolbar.vue
â”‚   â””â”€â”€ EditorToolbar.test.ts
â”œâ”€â”€ composables/
â”‚   â”œâ”€â”€ useRichTextEditor.ts
â”‚   â””â”€â”€ useRichTextEditor.test.ts   # Composable æµ‹è¯•
â””â”€â”€ services/
    â”œâ”€â”€ richText.ts                  # å¯Œæ–‡æœ¬å·¥å…·å‡½æ•°
    â””â”€â”€ richText.test.ts             # å±æ€§åŸºæµ‹è¯•
```

