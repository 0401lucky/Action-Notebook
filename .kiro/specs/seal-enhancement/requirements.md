# 需求文档

## 简介

封存功能优化旨在改进"行动手帐"应用中的封存机制和日记功能，使其更加灵活。主要包含两个方面：
1. **解封功能**：当前封存后记录完全锁定，用户无法继续添加任务或修改日记。优化后，用户可以选择"解封"已封存的记录，继续编辑后再次封存。
2. **日记本功能**：将单一日记文本框改为日记本模式，用户可以在一天内多次添加日记条目，每条日记带有时间戳，形成时间线式的记录。

## 术语表

- **封存（Seal）**: 将当日记录标记为完成状态，归档到历史记录中
- **解封（Unseal）**: 将已封存的记录恢复为可编辑状态
- **日记条目（JournalEntry）**: 单条日记记录，包含内容、创建时间
- **日记本（Journal）**: 当日所有日记条目的集合，按时间排序
- **DailyRecord**: 每日记录数据结构，包含任务、日记条目列表、心情等信息
- **Archive**: 已封存记录的归档列表

## 需求

### 需求 1

**用户故事：** 作为用户，我希望能够解封已封存的记录，以便在需要时继续添加任务或修改日记内容。

#### 验收标准

1. WHEN 用户查看已封存的记录 THEN 系统 SHALL 显示"解封"按钮
2. WHEN 用户点击"解封"按钮 THEN 系统 SHALL 将记录的 isSealed 状态设置为 false
3. WHEN 记录被解封 THEN 系统 SHALL 允许用户添加、删除、修改任务
4. WHEN 记录被解封 THEN 系统 SHALL 允许用户编辑日记内容和心情
5. WHEN 记录被解封 THEN 系统 SHALL 保留原有的封存时间记录（sealedAt）作为历史参考

### 需求 2

**用户故事：** 作为用户，我希望解封操作有确认提示，以防止误操作。

#### 验收标准

1. WHEN 用户点击"解封"按钮 THEN 系统 SHALL 显示确认对话框
2. WHEN 确认对话框显示 THEN 系统 SHALL 包含"确认解封"和"取消"两个选项
3. WHEN 用户点击"确认解封" THEN 系统 SHALL 执行解封操作
4. WHEN 用户点击"取消" THEN 系统 SHALL 关闭对话框并保持记录封存状态

### 需求 3

**用户故事：** 作为用户，我希望在今日页面能够解封当天的记录，以便快速继续编辑。

#### 验收标准

1. WHEN 今日记录已封存 THEN 系统 SHALL 在封存按钮位置显示"已封存 · 点击解封"
2. WHEN 用户点击"已封存 · 点击解封" THEN 系统 SHALL 触发解封确认流程
3. WHEN 今日记录解封成功 THEN 系统 SHALL 恢复任务输入框和日记编辑器的可编辑状态

### 需求 4

**用户故事：** 作为用户，我希望在归档详情页也能解封历史记录，以便修正过去的记录。

#### 验收标准

1. WHEN 用户查看归档详情页 THEN 系统 SHALL 显示"解封编辑"按钮
2. WHEN 用户在详情页解封记录 THEN 系统 SHALL 跳转到今日页面并加载该记录
3. WHEN 历史记录被解封 THEN 系统 SHALL 从归档列表中移除该记录直到再次封存

### 需求 5

**用户故事：** 作为用户，我希望解封后的记录能够再次封存，以便完成编辑后归档。

#### 验收标准

1. WHEN 解封后的记录满足封存条件 THEN 系统 SHALL 显示"封存"按钮
2. WHEN 用户再次封存记录 THEN 系统 SHALL 更新 sealedAt 为新的封存时间
3. WHEN 记录再次封存 THEN 系统 SHALL 将记录重新添加到归档列表



### 需求 6

**用户故事：** 作为用户，我希望能够在一天内多次添加日记条目，以便记录不同时间点的想法和事件。

#### 验收标准

1. WHEN 用户在日记区域输入内容并点击"添加" THEN 系统 SHALL 创建一条新的日记条目
2. WHEN 日记条目创建 THEN 系统 SHALL 自动记录创建时间（精确到分钟）
3. WHEN 用户添加多条日记 THEN 系统 SHALL 按时间倒序显示所有条目（最新的在上面）
4. WHEN 日记条目显示 THEN 系统 SHALL 展示时间标签（如"14:30"）和内容

### 需求 7

**用户故事：** 作为用户，我希望能够删除或编辑已添加的日记条目，以便修正错误或删除不需要的内容。

#### 验收标准

1. WHEN 记录未封存且用户点击日记条目的编辑按钮 THEN 系统 SHALL 允许用户修改该条目内容
2. WHEN 记录未封存且用户点击日记条目的删除按钮 THEN 系统 SHALL 显示确认提示
3. WHEN 用户确认删除 THEN 系统 SHALL 移除该日记条目
4. WHEN 记录已封存 THEN 系统 SHALL 禁用编辑和删除功能

### 需求 8

**用户故事：** 作为用户，我希望日记条目支持简单的格式，以便更好地组织内容。

#### 验收标准

1. WHEN 用户输入日记内容 THEN 系统 SHALL 保留换行格式
2. WHEN 日记条目显示 THEN 系统 SHALL 正确渲染换行
3. WHEN 日记条目为空或仅包含空白字符 THEN 系统 SHALL 拒绝添加并提示用户

### 需求 9

**用户故事：** 作为用户，我希望心情选择与日记条目关联，以便记录每个时刻的心情变化。

#### 验收标准

1. WHEN 用户添加日记条目 THEN 系统 SHALL 允许用户选择当前心情（可选）
2. WHEN 日记条目带有心情 THEN 系统 SHALL 在条目旁显示对应的心情 emoji
3. WHEN 用户不选择心情 THEN 系统 SHALL 允许添加不带心情的日记条目
4. WHEN 显示当日整体心情 THEN 系统 SHALL 使用最后一条带心情的日记条目的心情



### 需求 10

**用户故事：** 作为用户，我希望有一个专门的日记本书架页面，以便浏览和管理所有的日记本。

#### 验收标准

1. WHEN 用户访问日记本书架页面 THEN 系统 SHALL 以书架形式展示所有日记本
2. WHEN 日记本展示 THEN 系统 SHALL 按月份分组显示（如"2025年12月"）
3. WHEN 日记本展示 THEN 系统 SHALL 显示每本日记的封面信息（日期、条目数、主要心情）
4. WHEN 用户点击某本日记 THEN 系统 SHALL 跳转到该日记的详情页面
5. WHEN 某月没有日记记录 THEN 系统 SHALL 不显示该月份分组

### 需求 11

**用户故事：** 作为用户，我希望日记本有精美的视觉设计，以便获得愉悦的浏览体验。

#### 验收标准

1. WHEN 日记本书架渲染 THEN 系统 SHALL 使用书本样式的卡片设计
2. WHEN 日记本卡片显示 THEN 系统 SHALL 包含日期标签、心情 emoji 装饰、条目数量
3. WHEN 用户悬停在日记本卡片上 THEN 系统 SHALL 显示微妙的悬浮动画效果
4. WHEN 日记本书架渲染 THEN 系统 SHALL 使用与应用整体风格一致的玻璃拟态设计

### 需求 12

**用户故事：** 作为用户，我希望在仪表盘首页能看到日记本书架的预览，以便快速访问最近的日记。

#### 验收标准

1. WHEN 仪表盘加载 THEN 系统 SHALL 在日记卡片区域显示最近 3 本日记的书架预览
2. WHEN 日记书架预览显示 THEN 系统 SHALL 使用迷你书本样式展示
3. WHEN 用户点击"查看全部" THEN 系统 SHALL 跳转到完整的日记本书架页面
4. WHEN 用户点击某本迷你日记 THEN 系统 SHALL 跳转到该日记的详情页面

### 需求 13

**用户故事：** 作为用户，我希望能够通过导航快速访问日记本书架，以便随时查看历史日记。

#### 验收标准

1. WHEN 应用头部导航渲染 THEN 系统 SHALL 包含"日记本"导航链接
2. WHEN 用户点击"日记本"导航 THEN 系统 SHALL 跳转到日记本书架页面
3. WHEN 日记本书架页面加载 THEN 系统 SHALL 显示页面标题"我的日记本"

